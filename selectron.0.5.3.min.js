/*!
Selectron: Another Select Dropdown. Accessible, lightweight <select> replacement
@requires jQuery v1.7 or above

This is where a project URL would go

Copyright (c) 2012 Joe Shirley
Dual licensed under the MIT and GPL licenses:
http://www.opensource.org/licenses/mit-license.php
http://www.gnu.org/licenses/gpl.html
Version: 0.5.3

Uses: 'Highly configurable' mutable plugin boilerplate
http://coding.smashingmagazine.com/2011/10/11/essential-jquery-plugin-patterns/
Author: @markdalgleish
Further changes, comments: @addyosmani
Licensed under the MIT license
*/
;(function($,f,g,h){"use strict";var j=function(a,b){this.elem=a;this.$elem=$(a);this.options=b;this.ua=navigator.userAgent;this.isIpad=/iPad/i.test(this.ua)||/iPhone OS 3_1_2/i.test(this.ua)||/iPhone OS 3_2_2/i.test(this.ua);this.metadata=this.$elem.data("selOptions")};j.prototype={defaults:{"delegate":"body","autoWidth":false,"inheritWidth":false,"showAnimation":{"height":"show"},"hideAnimation":{"height":"hide"},"showDuration":300,"showEasing":"swing","showSpecialEasing":null,"showStep":null,"preShow":function(a){},"showCallback":function(){},"hideDuration":300,"hideEasing":"swing","hideSpecialEasing":null,"hideStep":null,"hideCallback":function(){}},init:function(){this.config=$.extend({},this.defaults,this.options,this.metadata);this.$elem.data("selectronConfig",this.config);this.buildSelectron(this.elem);this.addHandlers(this.config);return this},buildSelectron:function(b){var c=$(b),optionsMap=c.children("option").map(function(a){return{label:$(this).attr("data-label")||$(this).text(),selected:($(this).prop("selected")?true:false),optIndex:a}}),selectedIndex=b.selectedIndex,selectronSelect=c.attr("name"),selOpts=c.data().selectronConfig,selectronHtml="<span class=\"selectron\" data-select=\""+selectronSelect+"\">"+"<div class=\"selectronSelected\">"+(selectedIndex?optionsMap[selectedIndex].label:("<span>"+optionsMap[selectedIndex].label+"</span>"))+"<span class=\"selIndicator\"></span></div>"+"<div class=\"selectronListWrapper\"><div></div>"+"<ul class=\"selectronList\">",$newSelectron={},$newSelectronClone={},$newSelectronCloneList={},selectCss={"display":(c.css("display")==="inline")?"inline-block":c.css("display"),"position":c.css("position")},listWidth,$ind,autoWidth,selBorderWidth,selInnerWidth;if(selOpts.inheritWidth){selectCss.width=c.css("width")}c.data("optionLabels",[]);$.each(optionsMap,function(i){var a=(this.selected?" selected":"");selectronHtml+="<li class=\"selectronLi"+a+"\" data-index=\""+this.optIndex+"\"><span>"+this.label+"</span></li>";c.data("optionLabels")[this.optIndex]=this.label});selectronHtml+="</ul>"+"</div>"+"</span>";c.after(selectronHtml);$newSelectron=$("span.selectron[data-select="+selectronSelect+"]");$newSelectronClone=$newSelectron.clone().css("visibility","hidden");$("body").append($newSelectronClone);$newSelectron.css(selectCss);$newSelectronClone.css(selectCss);if(selOpts.autoWidth||selOpts.inheritWidth){$newSelectronCloneList=$newSelectronClone.find("ul");$newSelectronClone.find("ul,li,li span").css("width","auto");listWidth=$newSelectronCloneList.width();if(selOpts.autoWidth){$ind=$newSelectronClone.find("span.selIndicator");autoWidth=listWidth+$ind.outerWidth(true)-$ind.css("marginRight").replace("px","")*1;$newSelectron.css({"width":autoWidth+"px"});$newSelectronClone.css({"width":autoWidth+"px"})}selBorderWidth=$newSelectronClone.find("div.selectronSelected").outerWidth()-$newSelectronClone.find("div.selectronSelected").innerWidth();selInnerWidth=$newSelectronClone.width()-selBorderWidth;$newSelectron.find("div.selectronListWrapper > div").css("width",($newSelectronClone.find("div.selectron").innerWidth()-selBorderWidth)+"px");$newSelectron.find("ul.selectronList").css("width",selInnerWidth+"px")}$newSelectronClone.remove();$newSelectron.find(".selectronList").hide();c.css({"position":"absolute","left":"-9999em","display":(this.isIpad?"none":c.css("display"))})},showList:function(a){var b=$(a),opts=$("select[name="+b.attr("data-select")+"]").data().selectronConfig,showOpts={"duration":opts.showDuration,"easing":opts.showEasing,"complete":function(){if(!$.support.opacity){this.style.removeAttribute('filter')}b.removeClass("showing").addClass("shown");opts.showCallback.call(a)}};if(opts.showSpecialEasing){showOpts.specialEasing=opts.showSpecialEasing}b.stop().removeClass("shown hiding").addClass("showing").find(".selectronListWrapper > div").show();opts.preShow.call(a);b.find("ul").animate(opts.showAnimation,showOpts)},hideLists:function(b){var c=b||"span.selectron",$lists=$(c).filter(".shown, .showing");$lists.each(function(){var a=$(this),opts=$("select[name="+a.attr("data-select")+"]").data().selectronConfig,hideOpts={"duration":opts.hideDuration,"easing":opts.hideEasing,"complete":function(){a.removeClass("hiding shown");a.find(".selectronListWrapper > div").hide();opts.hideCallback.call(this)}};if(opts.hideSpecialEasing){hideOpts.specialEasing=opts.hideSpecialEasing}$lists.stop().removeClass("shown showing").addClass("hiding");$lists.find(".selectronList").animate(opts.hideAnimation,hideOpts)})},setFocus:function(a,b){var c=null;if(b&&!a){c=$("select[name="+$(b).attr("data-select")+"]")}else if(a){c=$(a)}if(c){c.focus()}},handle:function(e,b,c){var d,$origSelect,$curSelectron,selectedIndex,keyPressed,selectedHtml="",papaThis=this;if((e.type==="mousedown"||e.type==="click")&&b!=="deselectAll"){e.stopPropagation();e.preventDefault()}switch(b){case"deselectAll":if(!$(c).is("span.selectron")){papaThis.hideLists()}break;case"selectedToggleShown":d=$(c).parents("span.selectron");papaThis.setFocus(null,d[0]);$("span.selectron").each(function(){var a=$(this);if(!a.is(d[0])&&a.is(".shown, .showing")){papaThis.hideLists(a[0])}});if(d.is(".showing, .shown")){papaThis.hideLists(d[0])}else{papaThis.showList(d[0])}break;case"changeSelected":d=$(c).parents("span.selectron");$origSelect=$("select[name="+d.attr("data-select")+"]");papaThis.setFocus(null,d[0]);$origSelect.prop("selectedIndex",$(c).attr("data-index"));$origSelect.trigger("change");if(e.type==="click"){papaThis.hideLists(d)}break;case"oldIeShim":e.stopPropagation();e.preventDefault();setTimeout(function(){d=$(c).parents("span.selectron");$origSelect=$("select[name="+d.attr("data-select")+"]");$origSelect.focus()},0);break;case"tabDeselect":$curSelectron=$("span.selectron[data-select="+$(c).attr("name")+"]");papaThis.hideLists($curSelectron[0]);break;case"reflectChange":$curSelectron=$("span.selectron[data-select="+$(c).attr("name")+"]");if($curSelectron.length>0){if(e.type==="focusin"){$curSelectron.addClass("selectronFocused")}else if(e.type==="focusout"){$curSelectron.removeClass("selectronFocused");if(!($.browser.msie&&parseInt($.browser.version,10)<10)){papaThis.hideLists($curSelectron[0])}}if(e.type==="keyup"||e.type==="keydown"||e.type==="change"){selectedIndex=$(c).prop("selectedIndex");setTimeout(function(){var a=$(c);if((e.type==="change"||e.type==="keyup")||selectedIndex!==a.prop("selectedIndex")){selectedIndex=a.prop("selectedIndex");selectedHtml=a.data("optionLabels")[selectedIndex];$curSelectron.find(".selectronSelected").html(selectedHtml+"<span class=\"selIndicator\"></span>");$curSelectron.find("li").removeClass("selected").parent().find("[data-index="+selectedIndex+"]").addClass("selected")}keyPressed=e.keyCode||e.which;if(e.type==="keyup"&&keyPressed===13){papaThis.hideLists($curSelectron[0])}},1)}}break}},addHandlers:function(b){var c=this;if(!$.selectron){$.selectron={};$("html").on("keydown.selectron",function(e){var a=e.keyCode||e.which;if(a===9){c.handle(e,"tabDeselect",this)}else if(a===27){c.hideLists()}});$(b.delegate).on("mousedown.selectron",".selectronSelected, .selectronSelected > span",function(e){var a=this;if(($.browser.msie&&parseInt($.browser.version,10)<10)){c.handle(e,"oldIeShim",this)}c.handle(e,"selectedToggleShown",this)});if(($.browser.msie&&parseInt($.browser.version,10)<10)){}$(b.delegate).on("mousedown.selectron",".selectronLi",function(e){e.preventDefault();e.stopPropagation();if(($.browser.msie&&parseInt($.browser.version,10)<10)){c.handle(e,"oldIeShim",this)}});$(b.delegate).on("click.selectron",".selectronLi",function(e){c.handle(e,"changeSelected",this)});$("body").on("focusin.selectron focusout.selectron change.selectron keyup.selectron keydown.selectron","select",function(e){c.handle(e,"reflectChange",this)})}}};j.defaults=j.prototype.defaults;$.fn.selectron=function(b){return this.each(function(){var a=$(this);if(a.is("select")){if($("span.selectron[data-select="+a.attr("name")+"]").length<1){return new j(this,b).init()}else{$.extend($(this).data("selectronConfig"),b)}}else if(a.find("select").length>0){a.find("select").each(function(){if($("span.selectron[data-select="+$(this).attr("name")+"]").length<1){return new j(this,b).init()}else{$.extend($(this).data("selectronConfig"),b)}})}})}})(jQuery,window,console);